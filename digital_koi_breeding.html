<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-109031298-1"></script><script src="js/google.js"></script><title>Job Talle | Digital koi breeding</title><meta charset="UTF-8"><meta name="description" content=""/><meta name="keywords" content="software development, AI, algorithms, programming, Job Talle"/><meta name="author" content="Job Talle"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:locale" content="en_US"/><meta property="og:title" content="Digital koi breeding"/><meta property="og:url" content="https://jobtalle.com/digital_koi_breeding.html"/><meta property="og:description" content=""/><meta property="og:image" content="https://jobtalle.com/posts/2022_6_12/img/preview.jpg"/><meta property="twitter:image" content="https://jobtalle.com/posts/2022_6_12/img/preview.jpg"/><meta property="twitter:description" content=""/><meta property="twitter:site" content="jobtalle.com"/><meta property="twitter:card" content="summary"/><meta property="twitter:title" content="Digital koi breeding"/><link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet"/><link rel="shortcut icon" type="image/gif" href="img/favicon.gif"/><link rel="stylesheet" type="text/css" href="css/style.css"/><link rel="stylesheet" type="text/css" href="posts/2022_6_12/css/style.css"></head><body><div id="container"><div id="menu-wrapper"><div id="menu-buttons"><a href="index.html"><div class="menu-button">Blog</div></a><a href="sketches.html"><div class="menu-button">Art</div></a><a href="about.html"><div class="menu-button">About</div></a><a href="contact.html"><div class="menu-button">Contact</div></a></div></div><div id="wrapper" class="container"><div id="header"><h1>Job Talle</h1><h2>On software development, AI & Algorithms</h2></div><div id="content"><h1>Digital koi breeding</h1><span class="date">12 Jun 2022</span><h2>Koi Farm</h2><p>Recently, I launched my game <em><a target="_blank" href="https://store.steampowered.com/app/1518810/Koi_Farm/">Koi Farm</a></em>. Koi Farm is a koi breeding game, in which the player breeds koi patterns by carefully selecting traits in the parents. This article explains how I implemented <em>crossbreeding</em> and <em>mutation</em> in koi patterns.</p><figure>    <img src="posts/2022_6_12/img/koifarm.jpg" alt="Koi Farm, the koi breeding game">    <figcaption>Figure 1: Koi Farm, the koi breeding game.</figcaption></figure><p>Koi Farm is open source, so the algorithms can be seen in their "natural environment" <a target="_blank" href="https://github.com/jobtalle/koi">on GitHub</a>.</p><h2>Procedural mutable koi patterns</h2><p>The fish in Koi Farm have many mutable properties, like shape, size and color, but this article mostly goes into generating the <em>patterns</em> on the fish bodies. Most koi patterns contain spots of varying shapes and sizes.</p><p>The koi pattern generator needs to achieve the following main goals:</p><ul>    <li>There should be a nearly infinite number of possible patterns.</li>    <li>The patterns should have plenty of variance.</li>    <li>The patterns must be able to mutate in small steps.</li></ul><p>The first goal is obvious: if the koi are procedurally generated, every fish should be unique. The second goal is important to make the game fun; if all patterns are unique but still look very similar to each other, breeding koi gets boring quickly. Finally, mutation of patterns should happen in small steps. This is crucial for the gameplay. Specific koi patterns can be bred by choosing parent koi that almost have that pattern, because their children have a chance to mutate towards the desired look. If mutation happens in large steps, or if it would be completely random, there is no way to tell how the offspring of two fish may turn out. In that case, the entire gameplay mechanic of choosing parents to breed specific traits doesn't work.</p><h2>Slicing noise</h2><p>To create spots, I chose a method based on <em>slicing</em> noise. The following steps generate a texture with random spots:</p><ul>    <li>Generate a <em>3d noise</em>, in this case <a target="_blank" href="cubic_noise.html">Cubic Noise</a> was used.</li>    <li>Construct a <em>3d plane</em> that intersects the generated noise. The plane has the same size as the texture the generated spots are written to.</li>    <li>For every pixel on the plane corresponding to a pixel on the texture, the 3d noise is read. If the noise value is higher than a given threshold, this pixel is a spot. If it is lower, it's not a spot.</li></ul><figure>    <canvas width="500" height="250" id="renderer"></canvas>    <div id="buttons">        <button id="button-mutate">Mutate</button>        <button id="button-randomize">Randomize</button>    </div>    <div id="controls" class="controls">        <div id="modes" class="controls">            <label>                Texture:
                <input type="radio" name="mode" id="mode-texture" checked>            </label>            <label>                Shaped:
                <input type="radio" name="mode" id="mode-shape">            </label>            <label>                Animated:
                <input type="radio" name="mode" id="mode-animated">            </label>        </div>        <div class="controls" id="controls-texture">            <label>                X:
                <input type="range" min="-1" max="1" value="0" step="0.005" id="var-x">                <input readonly type="text" id="field-x" value="0">            </label>            <label>                Y:
                <input type="range" min="-1" max="1" value="0" step="0.005" id="var-y">                <input readonly type="text" id="field-y" value="0">            </label>            <label>                Z:
                <input type="range" min="-1" max="1" value="0" step="0.005" id="var-z">                <input readonly type="text" id="field-z" value="0">            </label>            <label>                X rotation:
                <input type="range" min="-180" max="180" value="0" step="1" id="var-x-rotation">                <input readonly type="text" id="field-x-rotation" value="0">            </label>            <label>                Y rotation:
                <input type="range" min="-180" max="180" value="0" step="1" id="var-y-rotation">                <input readonly type="text" id="field-y-rotation" value="0">            </label>            <label>                Threshold:
                <input type="range" min="0.3" max="0.7" value="0.5" step="0.002" id="var-threshold">                <input readonly type="text" id="field-threshold" value="0.5">            </label>            <label>                Scale:
                <input type="range" min="2" max="10" value="4.5" step="0.03" id="var-scale">                <input readonly type="text" id="field-scale" value="4.5">            </label>        </div>        <div class="controls hidden" id="controls-shape">            <label>                Width:
                <input type="range" min="0.65" max="1" value="0.8" step="0.001" id="var-width">                <input readonly type="text" id="field-width" value="0.8">            </label>            <label>                Radius:
                <input type="range" min="0.4" max="0.65" value="0.5" step="0.002" id="var-radius">                <input readonly type="text" id="field-radius" value="0.5">            </label>            <label>                Center:
                <input type="range" min="0.45" max="0.6" value="0.5" step="0.002" id="var-center">                <input readonly type="text" id="field-center" value="0.5">            </label>            <label>                Thickness:
                <input type="range" min="0.6" max="1.2" value="1" step="0.002" id="var-thickness">                <input readonly type="text" id="field-thickness" value="1">            </label>            <label>                Eye position:
                <input type="range" min="0.88" max="0.95" value="0.92" step="0.001" id="var-eye-position">                <input readonly type="text" id="field-eye-position" value="0.92">            </label>        </div>        <div class="controls hidden" id="controls-animation">            <label>                Speed:
                <input type="range" min="0" max="1" value="0.5" step="0.01" id="var-speed">                <input readonly type="text" id="field-speed" value="0.5">            </label>        </div>    </div></figure><p>The application on the right demonstrates the spot generator. The 3d noise is always the same, but the location and rotation of the 3d plane intersecting it can be changed to change the pattern. The scale of the plane determines the size of the spots; a very small plane contains only a small portion of the noise, while a scaled up plane contains a larger area and therefore more variation.</p><p>The <em>randomize</em> button randomizes the pattern by randomizing every plane parameter. The <em>mutate</em> button mutates the pattern by only changing the parameters a little. Because the plane is "nudged" through the 3d noise by small increments, the new mutated pattern will look similar to the pattern that was generated before, while mutating many times can completely change the pattern to every possible pattern this algorithm can create.</p><script type="module" src="posts/2022_6_12/js/main.js"></script><div id="references"><a href="rendering_symmetry.html" title="Previously: Rendering symmetry"><div class="post-reference post-reference-left">Rendering symmetry</div></a></div></div><div id="footer">&copy Job Talle 2017 - 2022</div><div id="icons"><a href="contact.html"><div class="icon" id="icon-mail" title="Mail"></div></a><a href="https://orcid.org/0000-0003-1946-8407" target="_blank"><div class="icon" id="icon-orcid" title="ORCID"></div></a><a href="https://www.github.com/jobtalle" target="_blank"><div class="icon" id="icon-github" title="Github"></div></a><a href="https://twitter.com/jobtalle" target="_blank"><div class="icon" id="icon-twitter" title="Twitter"></div></a><a href="https://www.linkedin.com/in/jobtalle" target="_blank"><div class="icon" id="icon-linkedin" title="LinkedIn"></div></a><a type="application/rss+xml" href="rss.xml" target="_blank"><div class="icon" id="icon-rss" title="RSS"></div></a></div></div></div></body></html>