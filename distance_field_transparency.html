<!DOCTYPE html><html lang="en"><head><title>Job Talle | Distance field transparency</title><meta charset="UTF-8"><meta name="description" content="Edges of partially transparent textures and sprites look pixelated and jagged when magnified. To increase the quality of these edges, signed distance fields can be used to render smooth edges that don't lose detail when zoomed in. This article provides a fast method and a tool to generate SDFs, and it goes into several ways of rendering them."/><meta name="keywords" content="software development, AI, algorithms, programming, Job Talle"/><meta name="author" content="Job Talle"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:locale" content="en_US"/><meta property="og:title" content="Distance field transparency"/><meta property="og:url" content="https://jobtalle.com/distance_field_transparency.html"/><meta property="og:description" content="Edges of partially transparent textures and sprites look pixelated and jagged when magnified. To increase the quality of these edges, signed distance fields can be used to render smooth edges that don't lose detail when zoomed in. This article provides a fast method and a tool to generate SDFs, and it goes into several ways of rendering them."/><meta property="og:image" content="https://jobtalle.com/posts/2023_6_2/img/preview.jpg"/><meta property="twitter:image" content="https://jobtalle.com/posts/2023_6_2/img/preview.jpg"/><meta property="twitter:description" content="Edges of partially transparent textures and sprites look pixelated and jagged when magnified. To increase the quality of these edges, signed distance fields can be used to render smooth edges that don't lose detail when zoomed in. This article provides a fast method and a tool to generate SDFs, and it goes into several ways of rendering them."/><meta property="twitter:site" content="jobtalle.com"/><meta property="twitter:card" content="summary"/><meta property="twitter:title" content="Distance field transparency"/><link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet"/><link rel="shortcut icon" type="image/gif" href="img/favicon.gif"/><link rel="stylesheet" type="text/css" href="css/style.css"/><link rel="stylesheet" href="lib/katex/katex.min.css"></head><body><div id="container"><div id="menu-wrapper"><div class="menu-button" id="menu-toggle" onclick="document.getElementById('menu-buttons').classList.toggle('visible')"><div class="burger-slice"></div><div class="burger-slice"></div><div class="burger-slice"></div></div><div id="menu-buttons"><a href="index.html"><div class="menu-button">Blog</div></a><a href="sketches.html"><div class="menu-button">Sketches</div></a><a href="games.html"><div class="menu-button">Games</div></a><a href="work.html"><div class="menu-button">Work</div></a><a href="about.html"><div class="menu-button">About</div></a><a href="contact.html"><div class="menu-button">Contact</div></a></div></div><div id="wrapper" class="container"><div id="header"><h1>Job Talle</h1><h2>On AI, Art & Algorithms</h2></div><div id="content"><h1>Distance field transparency</h1><span class="date">2 Jun 2023</span><h2>Textures with transparency</h2><p>Textures and sprite with (partially) transparent pixels are often used in computer graphics to add detail to 3D assets that's not in the model itself. Foliage rendering often makes use of textures containing many grass blades, instead of modelling every grass blade individually. This has performance benefits and allows the artist to add lots of small details to the scenery.</p><figure><img src="posts/2023_6_2/img/sdf.png" alt="SDF edges on a low resolution texture"><figcaption>Figure 1: A low resolution texture with edges defined by a signed distance field in its alpha channel.</figcaption></figure><p>Contrary to 3D models, the edges of these details become jagged and pixelated when zoomed in. If you look close enough, the separate pixels can be told apart. This can be mitigated by using higher resolution assets, but this hurts performance. To fix this problem, this article goes into generating <em>signed distance fields</em>, which can be used instead of pixel alpha values to define shapes on an image. Using SDFs over the alpha channel for transparency has several advantages:</p><ul><li>Smooth shape outlines which don't ever become pixelated when magnified</li><li>The SDF data fits into the alpha channel of a texture, so no new data needs to be allocated.</li><li>SDFs are very fast to use. They won't degrade performance.</li><li>The technique allows for <em>anti aliasing</em> the edges it describes, which is not possible with normal transparency.</li><li>SDFs retain fidelity even at low resolutions.</li></ul><p>Figure 1 shows a low resolution (125 by 125 pixels) texture of the <a target="_blank" href="https://store.steampowered.com/app/1518810/Koi_Farm/">Koi Farm</a> logo which contains a signed distance field in its alpha channel. The part inside the black circle uses this data to reconstruct smooth edges.</p><p>There are drawbacks too:</p><ul><li>SDFs can only store information about fully opaque shapes. There can't be partially transparent pixels on a texture that contains a SDF in its alpha channel.</li><li>SDFs need to be generated using a higher resolution version of the asset. This is only a problem if the input image is a raster image, since vector images can always be magnified.</li></ul><h2>Signed distance fields</h2><p>Signed distance field calculate for every pixel on the output image how far the center of that pixel is removed from the actual edge from the image. This is either a positive or a negative distance, since a pixel can be either inside or outside the shape described by the SDF. That's why the distance field is signed. If the distance towards the edge is negative the pixel is outside the shape, and if it's possible the distance is positive.</p><p>Because pixel opacity is stored in just one byte, this value is stored in the range $[0, 1]$ just like the three other color channel values are stored, where $0.5$ is the edge, so if the distance is $<0.5$, a pixel is outside the shape.</p><p>Rendering textures with SDFs is therefore fairly straightforward; the texture can be sampled normally using linear interpolation (and mipmapping if mipmaps are generated), and the alpha value is interpreted as the signed distance. If it is lower than $0.5$, the pixel should not be rendered, and if it is larger, the pixel should be opaque.</p><h2>Generating SDFs</h2><p>To generate SDFs, I have created an online tool called <a target="_blank" href="https://jobtalle.com/SDFMaker/"><em>SDF maker</em></a>. It takes either raster images or vector images and converts them to images with SDFs with a configurable output resolution and SDF radius. This paragraph explains how the tool was developed. The source code for this tool is released <a target="_blank" href="https://github.com/jobtalle/SDFMaker">on GitHub</a> under the MIT license.</p><p>While generating assets using tooling and shipping generated assets works well, it may also be useful to generate signed distance fields at runtime. Luckily, the algorithms used by this tool are fast enough to use live.</p><p>SDF maker requires a high resolution version of the texture that needs to be exported with a SDF. The resolution must be higher, because the SDF essentially stores a higher resolution shape than the lower resolution could otherwise contain. The algorithm performs the following steps to produce the lower resolution image with a SDF:</p><figure><img src="posts/2023_6_2/img/voronoi.jpg" alt="The Voronoi color texture and the output texture"><figcaption>Figure 2: The Voronoi color texture compared to the output texture.</figcaption></figure><ol><li>The high resolution source image is read.</li><li>The algorithm creates two <em>Voronoi diagrams</em> using the <em>Jump Flooding Algorithm</em>, one seeded with all opaque pixels and another one seeded with all transparent pixels.</li><li>A color texture is created. This texture has the same resolution as the input image, but every transparent pixel stores the color of the nearest opaque pixel instead. This is crucial for mipmapping, as explained in the next paragraph.</li><li>Mipmaps are generated for the color texture, which is then downscaled and rendered to the output image using mipmapping.</li><li>The distance to the edge is calculated from the Voronoi diagrams and stored on the output image. For every transparent pixel, the distance to the nearest opaque pixel is queried from the diagram, and every opaque pixels reads the distance to the nearest transparent pixel.</li></ol><h2>Mipmapping</h2><h2>Anti aliasing</h2><h2>Conclusion</h2><div id="references"><a href="digital_koi_breeding.html" title="Previously: Digital koi breeding"><div class="post-reference post-reference-left">Digital koi breeding</div></a></div></div><div id="footer">&copy Job Talle 2017 - 2023</div><div id="icons"><a href="contact.html"><div class="icon" id="icon-mail" title="Mail"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46 c78.279,0,141.73-63.461,141.73-141.73C283.46,63.451,220.009,0,141.73,0z"/><g fill="#FFF"><polygon points="57.737,193.24 103.702,135.45 57.737,107.352"/><polygon points="172.734,139.48 141.632,158.63 110.479,139.586 62.981,199.308 220.275,199.308"/><polygon points="141.624,149.382 225.722,97.59 225.722,84.152 57.737,84.152 57.737,98.113"/><polygon points="179.492,135.317 225.722,193.488 225.722,106.847"/></g></svg></div></a><a href="https://orcid.org/0000-0003-1946-8407" target="_blank"><div class="icon" title="ORCID"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 283.46 283.46" width="283.46" height="283.46" version="1.1"><path class="icon-body" d="m141.73,0c-78.275,0 -141.73,63.455 -141.73,141.73c0,78.275 63.455,141.73 141.73,141.73c78.275,0 141.73,-63.455 141.73,-141.73c0,-78.275 -63.455,-141.73 -141.73,-141.73z"/><g transform="matrix(1.107422241811154,0,0,1.107422241811154,10.99953146307012,219.93852396886876)" fill="#FFF"><path d="m76.36744,-12.40403l-15.4,0l0,-107.1l15.4,0l0,48.4l0,58.7z"/><path d="m98.96744,-119.50403l41.6,0c39.6,0 57,28.3 57,53.6c0,27.5 -21.5,53.6 -56.8,53.6l-41.8,0l0,-107.2zm15.4,93.3l24.5,0c34.9,0 42.9,-26.5 42.9,-39.7c0,-21.5 -13.7,-39.7 -43.7,-39.7l-23.7,0l0,79.4z"/><path d="m78.76744,-141.80403c0,5.5 -4.5,10.1 -10.1,10.1c-5.6,0 -10.1,-4.6 -10.1,-10.1c0,-5.6 4.5,-10.1 10.1,-10.1c5.6,0 10.1,4.6 10.1,10.1z"/></g></svg></div></a><a href="https://www.github.com/jobtalle" target="_blank"><div class="icon" title="Github"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.455,0,0,63.455,0,141.73c0,78.275,63.455,141.73,141.73,141.73 c78.275,0,141.73-63.455,141.73-141.73C283.46,63.455,220.005,0,141.73,0z"/><path fill="#FFF" d="M170.925,222.189H149.49h-21.455c0,0,0.062-12.73,0-21.455 c-29.36,6.324-37.554-16.091-37.554-16.091c-5.359-10.731-10.732-16.091-10.732-16.091c-10.731-6.369,0-5.359,0-5.359 c10.732,0,16.091,10.732,16.091,10.732c9.417,15.984,26.167,13.41,32.182,10.729c0-5.357,2.348-13.473,5.359-16.09 c-23.43-2.636-42.931-16.091-42.931-42.914c0-26.822,5.386-32.181,10.75-37.554c-1.081-2.644-5.576-12.424,0.164-26.823 c0,0,10.542,0,21.273,16.091c5.315-5.314,21.454-5.359,26.821-5.359c5.352,0,21.5,0.044,26.813,5.359 c10.729-16.091,21.299-16.091,21.299-16.091c5.74,14.399,1.249,24.179,0.164,26.823c5.359,5.359,10.729,10.731,10.729,37.554 c0,26.823-19.475,40.27-42.911,42.914c3.021,2.617,5.358,11.85,5.358,16.09L170.925,222.189L170.925,222.189z"/></svg></div></a><a href="https://twitter.com/jobtalle" target="_blank"><div class="icon" title="Twitter"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46S283.46,220,283.46,141.73 C283.46,63.451,220.009,0,141.73,0z"/><path fill="#FFF" d="M161.449,78.713c-14.085,5.129-22.987,18.345-21.978,32.811l0.336,5.581l-5.634-0.682 c-20.506-2.622-38.426-11.507-53.645-26.433l-7.441-7.405l-1.904,5.465c-4.057,12.189-1.462,25.068,6.989,33.732  c4.509,4.783,3.49,5.465-4.278,2.622c-2.702-0.912-5.076-1.594-5.297-1.249c-0.788,0.797,1.914,11.162,4.057,15.271 c2.932,5.705,8.902,11.277,15.44,14.589l5.527,2.622l-6.546,0.098c-6.307,0-6.537,0.114-5.855,2.516 c2.25,7.405,11.152,15.271,21.073,18.69l6.989,2.392l-6.085,3.649c-9.018,5.254-19.612,8.212-30.207,8.424 c-5.076,0.115-9.248,0.567-9.248,0.913c0,1.134,13.756,7.512,21.747,10.027c24.005,7.405,52.52,4.208,73.93-8.433 c15.219-9,30.428-26.894,37.532-44.221c3.835-9.221,7.662-26.086,7.662-34.174c0-5.244,0.337-5.926,6.644-12.189 c3.721-3.649,7.211-7.636,7.893-8.77c1.134-2.17,1.01-2.17-4.73-0.23c-9.575,3.419-10.931,2.968-6.191-2.161 c3.49-3.65,7.662-10.258,7.662-12.189c0-0.336-1.691,0.23-3.605,1.249c-2.028,1.143-6.537,2.853-9.921,3.871l-6.085,1.94 l-5.52-3.774c-3.047-2.046-7.316-4.332-9.575-5.014C175.426,76.658,166.639,76.889,161.449,78.713z"/></svg></div></a><a rel="me" href="https://mastodon.gamedev.place/@jobtalle" target="_blank"><div class="icon" title="Mastodon"><svg viewBox="100 71.886 283.46 283.46" width="283.46" height="283.46" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1, 0, 0, 1, 100, 71.88604)"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46S283.46,220,283.46,141.73 C283.46,63.451,220.009,0,141.73,0z"/></g><path fill="#FFF" d="M 321.979 235.324 C 319.488 248.139 299.668 262.165 276.905 264.883 C 265.034 266.3 253.347 267.602 240.884 267.03 C 220.503 266.096 204.421 262.165 204.421 262.165 C 204.421 264.149 204.543 266.038 204.788 267.806 C 207.437 287.92 224.733 289.125 241.116 289.686 C 257.651 290.252 272.374 285.61 272.374 285.61 L 273.053 300.558 C 273.053 300.558 261.487 306.768 240.884 307.911 C 229.523 308.535 215.416 307.625 198.986 303.276 C 163.35 293.844 157.222 255.858 156.284 217.316 C 155.998 205.873 156.174 195.082 156.174 186.058 C 156.174 146.646 181.997 135.093 181.997 135.093 C 195.017 129.114 217.359 126.599 240.586 126.41 L 241.156 126.41 C 264.383 126.599 286.74 129.114 299.759 135.093 C 299.759 135.093 325.581 146.646 325.581 186.058 C 325.581 186.058 325.905 215.135 321.979 235.324"/><path class="icon-body" d="M 295.123 189.115 L 295.123 236.835 L 276.216 236.835 L 276.216 190.517 C 276.216 180.754 272.109 175.798 263.891 175.798 C 254.805 175.798 250.251 181.677 250.251 193.301 L 250.251 218.654 L 231.457 218.654 L 231.457 193.301 C 231.457 181.677 226.903 175.798 217.817 175.798 C 209.6 175.798 205.491 180.754 205.491 190.517 L 205.491 236.835 L 186.586 236.835 L 186.586 189.115 C 186.586 179.362 189.069 171.612 194.057 165.878 C 199.201 160.144 205.937 157.204 214.299 157.204 C 223.974 157.204 231.3 160.923 236.145 168.361 L 240.854 176.255 L 245.564 168.361 C 250.408 160.923 257.733 157.204 267.41 157.204 C 275.77 157.204 282.507 160.144 287.652 165.878 C 292.638 171.612 295.123 179.362 295.123 189.115"/></svg></div></a><a href="https://www.linkedin.com/in/jobtalle" target="_blank"><div class="icon" title="LinkedIn"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46 c78.279,0,141.73-63.461,141.73-141.73C283.46,63.451,220.009,0,141.73,0z"/><path fill="#FFF" d="M215.199,203.223v-54.362c0-29.125-15.545-42.679-36.281-42.679c-16.732,0-24.229,9.204-28.398,15.661 v-13.438H119c0.417,8.902,0,94.817,0,94.817h31.517v-52.954c0-2.826,0.204-5.66,1.037-7.681c2.275-5.66,7.458-11.523,16.166-11.523 c11.408,0,15.971,8.689,15.971,21.438v50.729L215.199,203.223L215.199,203.223z M85.791,95.464c10.984,0,17.832-7.29,17.832-16.387 c-0.204-9.301-6.848-16.379-17.628-16.379c-10.78,0-17.822,7.078-17.822,16.379c0,9.106,6.838,16.387,17.424,16.387H85.791z M101.549,203.223v-94.817H70.041v94.817H101.549z"/></svg></div></a><a type="application/rss+xml" href="rss.xml" target="_blank"><div class="icon" title="RSS"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.586,0C63.387,0,0,63.386,0,141.587c0,78.191,63.387,141.586,141.586,141.586 c78.2,0,141.587-63.396,141.587-141.586C283.173,63.386,219.787,0,141.586,0z"/><path fill="#FFF" d="M192.071,200.408h26.035c0-74.634-60.714-135.393-135.339-135.393v25.963 C143.029,90.978,192.071,140.074,192.071,200.408z M100.792,200.451c9.982,0,18.043-8.016,18.043-17.953 c0-9.886-8.061-17.993-18.043-17.993c-9.938,0-18.017,8.107-18.017,17.993C82.767,192.435,90.846,200.451,100.792,200.451z M146.064,200.416L146.064,200.416h26.061c0-49.289-40.096-89.385-89.368-89.385v25.954c16.902,0,32.786,6.601,44.75,18.584 C139.472,167.505,146.064,183.461,146.064,200.416z"/></svg></div></a></div></div></div><script src="lib/katex/katex.min.js"></script><script src="lib/katex/contrib/auto-render.min.js"></script><script>renderMathInElement(document.getElementById("content"),{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false}]})</script></body></html>