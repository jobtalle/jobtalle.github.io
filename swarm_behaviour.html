<!DOCTYPE html><html lang="en"><head><title>Job Talle | Swarm behaviour</title><meta charset="UTF-8"><meta name="description" content="Swarm behaviour can be simulated using a few simple rules. Implementing these rules enables us to simulate flocking birds, schooling fish and swarming crowds. In this article, I walk through the process of implementing this algorithm."/><meta name="keywords" content="software development, AI, algorithms, programming, Job Talle"/><meta name="author" content="Job Talle"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:locale" content="en_US"/><meta property="og:title" content="Swarm behaviour"/><meta property="og:url" content="https://jobtalle.com/swarm_behaviour.html"/><meta property="og:description" content="Swarm behaviour can be simulated using a few simple rules. Implementing these rules enables us to simulate flocking birds, schooling fish and swarming crowds. In this article, I walk through the process of implementing this algorithm."/><meta property="og:image" content="https://jobtalle.com/posts/2018_2_1/img/preview.jpg"/><meta property="twitter:image" content="https://jobtalle.com/posts/2018_2_1/img/preview.jpg"/><meta property="twitter:description" content="Swarm behaviour can be simulated using a few simple rules. Implementing these rules enables us to simulate flocking birds, schooling fish and swarming crowds. In this article, I walk through the process of implementing this algorithm."/><meta property="twitter:site" content="jobtalle.com"/><meta property="twitter:card" content="summary"/><meta property="twitter:title" content="Swarm behaviour"/><link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet"/><link rel="shortcut icon" type="image/gif" href="img/favicon.gif"/><link rel="stylesheet" type="text/css" href="css/style.css"/><link rel="stylesheet" type="text/css" href="posts/2018_2_1/css/style.css"><link rel="stylesheet" href="lib/katex/katex.min.css"></head><body><div id="container"><div id="menu-wrapper"><div class="menu-button" id="menu-toggle" onclick="document.getElementById('menu-buttons').classList.toggle('visible')"><div class="burger-slice"></div><div class="burger-slice"></div><div class="burger-slice"></div></div><div id="menu-buttons"><a href="index.html"><div class="menu-button">Blog</div></a><a href="sketches.html"><div class="menu-button">Sketches</div></a><a href="games.html"><div class="menu-button">Games</div></a><a href="work.html"><div class="menu-button">Work</div></a><a href="about.html"><div class="menu-button">About</div></a><a href="contact.html"><div class="menu-button">Contact</div></a></div></div><div id="wrapper" class="container"><div id="header"><h1>Job Talle</h1><h2>On AI, Art & Algorithms</h2></div><div id="content"><h1>Swarm behaviour</h1><span class="date">1 Feb 2018</span><script src="posts/2018_2_1/js/agent.js"></script><script src="posts/2018_2_1/js/configuration.js"></script><script src="posts/2018_2_1/js/swarm.js"></script><script src="posts/2018_2_1/js/vector.js"></script><script src="posts/2018_2_1/js/view.js"></script><h2>Simulating swarms</h2><p>When the developers of the latest Call of Duty game in 2013 enthusiastically announced their state of the art "fish AI", they were ridiculed. After all, even the 1996 title Super Mario 64 featured fish reacting to their environments. While I can totally appreciate details like realistic animal behaviour in games, it should be said that simulating schooling behaviour is not that ground breaking. The algorithms are simpler than the emergent behaviour makes it seem. That does not make the applications less interesting though, and there are many.</p><figure title="Schooling fish"><img src="posts/2018_2_1/img/fish.jpg"><figcaption>Figure 1: schooling fish.</figcaption></figure><p>Swarming frequently occurs in nature. Animals often benefit from it because it offers them increased protection from predators, or it may help them follow the rest of the group to a destination. To name some common examples:</p><ul><li>Fish schooling</li><li>Birds flocking</li><li>Ants crawling</li><li>Cattle herding</li></ul><p>Many simple animals seem to create complex flocking patterns, but the same behaviour is also seen in complex animals. Crowds of humans show swarming behaviour too, and simulating this behaviour can help design spaces that are suitable for crowds. A designer may design a space in such a way that the crowd follows a general path, or a design can be devised to maximize throughput. Another application is simulating the time it takes for a large number of people to evacuate a space. In this article, I walk through the process of creating a simple swarming algorithm.</p><h2>Boids</h2><p>One of the first algorithms for flocking called <em>Boids</em> was made by Craig Reynolds in 1986. The simulation I have implemented mostly follows his design. In this algorithm, every agent determines how it should move or steer by itself. Agents have a limited view of the world around them, and their behaviour is determined by what they sense. The goal of the algorithm is to make agents stay together, without touching or colliding too much and without the group falling apart. This is accomplished by using three different sensing areas which trigger three kinds of behaviour.</p><figure title="An agent from Boids"><img src="posts/2018_2_1/img/boid.jpg"><figcaption>Figure 2: the perception of an agent.</figcaption></figure><p>Figure 2 shows the sensing areas of an agent. The three colored zones around the agent center will tell the agent when other agents are detected in that area. The behaviour an agent will show depends on the zone other agents are detected in. The three zones have three different effects:</p><ul><li>The area closest to the agent is the <em>repulsion zone</em>. When agents are in each others repulsion zone, they will move away from each other. This zone could be analogous to touch or very close proximity; schooling fish for example will try not to touch each other by staying out of this zone.</li><li>The ring around the repulsion zone is the <em>alignment zone</em>. If agents are in each others alignment zone, they will both steer to match each others direction; they want to stay together, and moving into the same direction will accomplish that. Once agents are aligned, little steering is required.</li><li>The outer ring is called the <em>attraction zone</em>. If an agent detects another agent in the attraction zone, it will steer towards that agent in order to follow it. I have limited this zone by a certain angle to simulate the field of view of eyes. An agent won't usually steer towards agents behind it, because it doesn't have eyes in its back.</li></ul><p>When agents apply the three simple rules above, seemingly complex behaviour emerges. The implementation can be tested below, and its javascript source can be found <a href="https://github.com/jobtalle/Swarm" target="_blank">here</a>. The effect of all parameters is explained below.</p><div class="full-width"><canvas id="renderer" width=480 height=512></canvas><div id="controls"><table><tr><td>Agents:</td><td><input class="input-slider" type="range" min="0" max="250" value="20" id="input-agent-count" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-agent-count"></td></tr><tr><td>Agent speed:</td><td><input class="input-slider" type="range" min="0" max="100" value="65" id="input-agent-speed" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-agent-speed"></td></tr><tr><td>Repulsion zone:</td><td><input class="input-slider" type="range" min="0" max="64" value="17" id="input-zone-repulsion" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-zone-repulsion"></td></tr><tr><td>Alignment zone:</td><td><input class="input-slider" type="range" min="0" max="64" value="8" id="input-zone-alignment" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-zone-alignment"></td></tr><tr><td>Attraction zone:</td><td><input class="input-slider" type="range" min="0" max="64" value="16" id="input-zone-attraction" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-zone-attraction"></td></tr><tr><td>Attraction angle:</td><td><input class="input-slider" type="range" min="0" max="360" value="140" id="input-angle-attraction" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-angle-attraction"></td></tr><tr><td>Repulsion force:</td><td><input class="input-slider" type="range" min="0" max="10" step="0.25" value="7" id="input-strength-repulsion" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-strength-repulsion"></td></tr><tr><td>Alignment force:</td><td><input class="input-slider" type="range" min="0" max="10" step="0.25" value="3" id="input-strength-alignment" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-strength-alignment"></td></tr><tr><td>Attraction force:</td><td><input class="input-slider" type="range" min="0" max="10" step="0.25" value="1" id="input-strength-attraction" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-strength-attraction"></td></tr><tr><td>Gravitation force</td><td><input class="input-slider" type="range" min="0" max="10" step="0.25" value="0.75" id="input-strength-gravitation" onchange="sim.configure();"></td><td><input class="input-value" type="text" readonly id="value-strength-gravitation"></td></tr></table><button onclick="sim.scatter();">Scatter</button><script>sim = new SwarmSim(document.getElementById("renderer")); sim.start();</script></div></div><p>The application above has a number of parameters which influence agent behaviour.</p><ul><li><em>Agent speed</em> determines the minimum speed of an agent; an agent that does not experience any influence will move with this speed.</li><li><em>Repulsion</em>, <em>alignment</em> and <em>attraction</em> zone determine the radii of the aforementioned zones. These add up to each other.</li><li>The <em>attraction angle</em> determines the angle of an agents field of view in degrees.</li><li>The forces determine the magnitude of influences. For example, if an agent has another agent in its repulsion zone, its velocity will move away from the other agent with a magnitude of <em>Repulsion force</em>. The force is added every time an agent is encountered, so the more agents, the more force is added.</li><li><em>Gravitation force</em> determines the force that will be added in the direction of the view center. This makes sure all agents move towards the center, which makes larger groups of agents turn as a whole.</li></ul><p>To sum it all up, the velocity of an agent is updated using the following formula:</p><p>$$\vec{v_{next}} = |\vec{v}| * s + \sum_{n=1}^{rc} |\vec{r_n}| * f_r + \sum_{n=1}^{ac} |\vec{a_n}| * f_a + \sum_{n=1}^{tc} |\vec{t_n}| * f_t$$</p><p>where $\vec{v}$ is velocity, $s$ is agent speed, $rc$, $ac$ and $tc$ are repulsion, alignment and attraction agent counts respectively. $\vec{r_x}$, $\vec{a_x}$ and $\vec{t_x}$ denote the $x^{th}$ vector in the influence directions of repulsion, alignment and attraction respectively, and $f_r$, $f_a$ and $f_t$ are the forces appointed to repulsion, alignment and attraction. In the example above, gravitation force is added. This is not incorporated in the formula.</p><p>This function could of course be applied to any number of dimensions. The simulation above is 2D, but moving it to 3D is trivial once good rules have been established.</p><p>It is worth mentioning that the time complexity of my algorithm is $O(n^2)$, because I check the distance between every pair of agents once. For very large swarms, additional optimization would be required. A naive implementation might let every agent check against every other agent, but this results in many redundant checks because pairs will be evaluated twice.</p><h2>Conclusion</h2><p>While fish AI is an interesting use of swarm behaviour, there are many more useful applications. One could think of simulations that help with optimizing crowd flow, traffic management in a city or building layout design. Another use could be drone flocking behaviour; if drones need to stay together, flocking behaviour could be a property borrowed from nature like many other natural principles that are applied to technology. For these applications, the example above needs to be expanded. There are many possible additions:</p><ul><li>Obstacle avoidance</li><li>When no other agents can be detected, an agent could look further away</li><li>Influence from weather conditions</li><li>Different types of agents, some could be more influential than others</li><li>Predators driving the flock apart</li><li>Signals that agents could pass on to their neighbours</li></ul><p>I have released the source code <a href="https://github.com/jobtalle/Swarm" target="_blank">on GitHub</a> under the MIT license.</p><div id="references"><a href="lindenmayer_systems.html" title="Previously: Lindenmayer systems"><div class="post-reference post-reference-left">Lindenmayer systems</div></a><a href="simulated_ecosystems.html" title="Up next: Simulated ecosystems"><div class="post-reference post-reference-right">Simulated ecosystems</div></a></div></div><div id="footer">&copy Job Talle 2017 - 2023</div><div id="icons"><a href="contact.html"><div class="icon" id="icon-mail" title="Mail"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46 c78.279,0,141.73-63.461,141.73-141.73C283.46,63.451,220.009,0,141.73,0z"/><g fill="#FFF"><polygon points="57.737,193.24 103.702,135.45 57.737,107.352"/><polygon points="172.734,139.48 141.632,158.63 110.479,139.586 62.981,199.308 220.275,199.308"/><polygon points="141.624,149.382 225.722,97.59 225.722,84.152 57.737,84.152 57.737,98.113"/><polygon points="179.492,135.317 225.722,193.488 225.722,106.847"/></g></svg></div></a><a href="https://orcid.org/0000-0003-1946-8407" target="_blank"><div class="icon" title="ORCID"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 283.46 283.46" width="283.46" height="283.46" version="1.1"><path class="icon-body" d="m141.73,0c-78.275,0 -141.73,63.455 -141.73,141.73c0,78.275 63.455,141.73 141.73,141.73c78.275,0 141.73,-63.455 141.73,-141.73c0,-78.275 -63.455,-141.73 -141.73,-141.73z"/><g transform="matrix(1.107422241811154,0,0,1.107422241811154,10.99953146307012,219.93852396886876)" fill="#FFF"><path d="m76.36744,-12.40403l-15.4,0l0,-107.1l15.4,0l0,48.4l0,58.7z"/><path d="m98.96744,-119.50403l41.6,0c39.6,0 57,28.3 57,53.6c0,27.5 -21.5,53.6 -56.8,53.6l-41.8,0l0,-107.2zm15.4,93.3l24.5,0c34.9,0 42.9,-26.5 42.9,-39.7c0,-21.5 -13.7,-39.7 -43.7,-39.7l-23.7,0l0,79.4z"/><path d="m78.76744,-141.80403c0,5.5 -4.5,10.1 -10.1,10.1c-5.6,0 -10.1,-4.6 -10.1,-10.1c0,-5.6 4.5,-10.1 10.1,-10.1c5.6,0 10.1,4.6 10.1,10.1z"/></g></svg></div></a><a href="https://www.github.com/jobtalle" target="_blank"><div class="icon" title="Github"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.455,0,0,63.455,0,141.73c0,78.275,63.455,141.73,141.73,141.73 c78.275,0,141.73-63.455,141.73-141.73C283.46,63.455,220.005,0,141.73,0z"/><path fill="#FFF" d="M170.925,222.189H149.49h-21.455c0,0,0.062-12.73,0-21.455 c-29.36,6.324-37.554-16.091-37.554-16.091c-5.359-10.731-10.732-16.091-10.732-16.091c-10.731-6.369,0-5.359,0-5.359 c10.732,0,16.091,10.732,16.091,10.732c9.417,15.984,26.167,13.41,32.182,10.729c0-5.357,2.348-13.473,5.359-16.09 c-23.43-2.636-42.931-16.091-42.931-42.914c0-26.822,5.386-32.181,10.75-37.554c-1.081-2.644-5.576-12.424,0.164-26.823 c0,0,10.542,0,21.273,16.091c5.315-5.314,21.454-5.359,26.821-5.359c5.352,0,21.5,0.044,26.813,5.359 c10.729-16.091,21.299-16.091,21.299-16.091c5.74,14.399,1.249,24.179,0.164,26.823c5.359,5.359,10.729,10.731,10.729,37.554 c0,26.823-19.475,40.27-42.911,42.914c3.021,2.617,5.358,11.85,5.358,16.09L170.925,222.189L170.925,222.189z"/></svg></div></a><a href="https://twitter.com/jobtalle" target="_blank"><div class="icon" title="Twitter"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46S283.46,220,283.46,141.73 C283.46,63.451,220.009,0,141.73,0z"/><path fill="#FFF" d="M161.449,78.713c-14.085,5.129-22.987,18.345-21.978,32.811l0.336,5.581l-5.634-0.682 c-20.506-2.622-38.426-11.507-53.645-26.433l-7.441-7.405l-1.904,5.465c-4.057,12.189-1.462,25.068,6.989,33.732  c4.509,4.783,3.49,5.465-4.278,2.622c-2.702-0.912-5.076-1.594-5.297-1.249c-0.788,0.797,1.914,11.162,4.057,15.271 c2.932,5.705,8.902,11.277,15.44,14.589l5.527,2.622l-6.546,0.098c-6.307,0-6.537,0.114-5.855,2.516 c2.25,7.405,11.152,15.271,21.073,18.69l6.989,2.392l-6.085,3.649c-9.018,5.254-19.612,8.212-30.207,8.424 c-5.076,0.115-9.248,0.567-9.248,0.913c0,1.134,13.756,7.512,21.747,10.027c24.005,7.405,52.52,4.208,73.93-8.433 c15.219-9,30.428-26.894,37.532-44.221c3.835-9.221,7.662-26.086,7.662-34.174c0-5.244,0.337-5.926,6.644-12.189 c3.721-3.649,7.211-7.636,7.893-8.77c1.134-2.17,1.01-2.17-4.73-0.23c-9.575,3.419-10.931,2.968-6.191-2.161 c3.49-3.65,7.662-10.258,7.662-12.189c0-0.336-1.691,0.23-3.605,1.249c-2.028,1.143-6.537,2.853-9.921,3.871l-6.085,1.94 l-5.52-3.774c-3.047-2.046-7.316-4.332-9.575-5.014C175.426,76.658,166.639,76.889,161.449,78.713z"/></svg></div></a><a rel="me" href="https://mastodon.gamedev.place/@jobtalle" target="_blank"><div class="icon" title="Mastodon"><svg viewBox="100 71.886 283.46 283.46" width="283.46" height="283.46" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1, 0, 0, 1, 100, 71.88604)"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46S283.46,220,283.46,141.73 C283.46,63.451,220.009,0,141.73,0z"/></g><path fill="#FFF" d="M 321.979 235.324 C 319.488 248.139 299.668 262.165 276.905 264.883 C 265.034 266.3 253.347 267.602 240.884 267.03 C 220.503 266.096 204.421 262.165 204.421 262.165 C 204.421 264.149 204.543 266.038 204.788 267.806 C 207.437 287.92 224.733 289.125 241.116 289.686 C 257.651 290.252 272.374 285.61 272.374 285.61 L 273.053 300.558 C 273.053 300.558 261.487 306.768 240.884 307.911 C 229.523 308.535 215.416 307.625 198.986 303.276 C 163.35 293.844 157.222 255.858 156.284 217.316 C 155.998 205.873 156.174 195.082 156.174 186.058 C 156.174 146.646 181.997 135.093 181.997 135.093 C 195.017 129.114 217.359 126.599 240.586 126.41 L 241.156 126.41 C 264.383 126.599 286.74 129.114 299.759 135.093 C 299.759 135.093 325.581 146.646 325.581 186.058 C 325.581 186.058 325.905 215.135 321.979 235.324"/><path class="icon-body" d="M 295.123 189.115 L 295.123 236.835 L 276.216 236.835 L 276.216 190.517 C 276.216 180.754 272.109 175.798 263.891 175.798 C 254.805 175.798 250.251 181.677 250.251 193.301 L 250.251 218.654 L 231.457 218.654 L 231.457 193.301 C 231.457 181.677 226.903 175.798 217.817 175.798 C 209.6 175.798 205.491 180.754 205.491 190.517 L 205.491 236.835 L 186.586 236.835 L 186.586 189.115 C 186.586 179.362 189.069 171.612 194.057 165.878 C 199.201 160.144 205.937 157.204 214.299 157.204 C 223.974 157.204 231.3 160.923 236.145 168.361 L 240.854 176.255 L 245.564 168.361 C 250.408 160.923 257.733 157.204 267.41 157.204 C 275.77 157.204 282.507 160.144 287.652 165.878 C 292.638 171.612 295.123 179.362 295.123 189.115"/></svg></div></a><a href="https://www.linkedin.com/in/jobtalle" target="_blank"><div class="icon" title="LinkedIn"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.73,0C63.451,0,0,63.451,0,141.73C0,220,63.451,283.46,141.73,283.46 c78.279,0,141.73-63.461,141.73-141.73C283.46,63.451,220.009,0,141.73,0z"/><path fill="#FFF" d="M215.199,203.223v-54.362c0-29.125-15.545-42.679-36.281-42.679c-16.732,0-24.229,9.204-28.398,15.661 v-13.438H119c0.417,8.902,0,94.817,0,94.817h31.517v-52.954c0-2.826,0.204-5.66,1.037-7.681c2.275-5.66,7.458-11.523,16.166-11.523 c11.408,0,15.971,8.689,15.971,21.438v50.729L215.199,203.223L215.199,203.223z M85.791,95.464c10.984,0,17.832-7.29,17.832-16.387 c-0.204-9.301-6.848-16.379-17.628-16.379c-10.78,0-17.822,7.078-17.822,16.379c0,9.106,6.838,16.387,17.424,16.387H85.791z M101.549,203.223v-94.817H70.041v94.817H101.549z"/></svg></div></a><a type="application/rss+xml" href="rss.xml" target="_blank"><div class="icon" title="RSS"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="283.46px" height="283.46px" viewBox="0 0 283.46 283.46"><path class="icon-body" d="M141.586,0C63.387,0,0,63.386,0,141.587c0,78.191,63.387,141.586,141.586,141.586 c78.2,0,141.587-63.396,141.587-141.586C283.173,63.386,219.787,0,141.586,0z"/><path fill="#FFF" d="M192.071,200.408h26.035c0-74.634-60.714-135.393-135.339-135.393v25.963 C143.029,90.978,192.071,140.074,192.071,200.408z M100.792,200.451c9.982,0,18.043-8.016,18.043-17.953 c0-9.886-8.061-17.993-18.043-17.993c-9.938,0-18.017,8.107-18.017,17.993C82.767,192.435,90.846,200.451,100.792,200.451z M146.064,200.416L146.064,200.416h26.061c0-49.289-40.096-89.385-89.368-89.385v25.954c16.902,0,32.786,6.601,44.75,18.584 C139.472,167.505,146.064,183.461,146.064,200.416z"/></svg></div></a></div></div></div><script src="lib/katex/katex.min.js"></script><script src="lib/katex/contrib/auto-render.min.js"></script><script>renderMathInElement(document.getElementById("content"),{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false}]})</script></body></html>